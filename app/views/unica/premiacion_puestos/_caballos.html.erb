<script type="text/javascript">
  window.total_inicial_ca = Number(<%= @caballos_array.count %>) ;
  window.cantidad_total = Number(<%= @canti_p %> );
  window.cab_en_ju = Number(<%= @caballos_array.count %>) - 1;
  window.cab_en_ju_total = window.cab_en_ju +1 ;
  function minmax(value, min, max) {
    if(parseInt(value) < min || isNaN(parseInt(value)))
        return min;
    else if(parseInt(value) > max)
        return max;
    else return value;
  }
</script>

  <div class="row">
    <div class="col-12 col-sm-7">
      <table id="caballos_enter" class="table table-bordered table-striped dataTable" role="grid">
        <thead>
          <tr>
            <th class="col-sm-1 text-right th-responsive">
              <span class="th-full-text">Numero</span>
              <span class="th-short-text">Nro</span>
            </th>
            <th class="col-sm-2 text-left">Nombre</th>
            <th class="col-sm-1 text-right th-responsive">
              <span class="th-full-text " style="padding-right: 1rem;">Retirado</span>
              <span class="th-short-text" style="padding-right: 3rem;">Ret</span>
            </th>
            <th class="col-sm-1 text-left th-responsive">
              <span class="th-full-text" style="padding-left: 1rem;">Posici&oacute;n</span>
              <span class="th-short-text" style="padding-left: 1rem;">Posici</span>
            </th>
            <th class="col-sm-1 text-left th-responsive">
              <span class="th-full-text">Sugeridos API</span>
              <span class="th-short-text" style="padding-left: 1rem;">S API</span>
            </th>
            <th class="col-sm-1 text-left th-responsive">
              <span class="th-full-text">Resultados Nyra</span>
              <span class="th-short-text" style="padding-left: 1rem;">NYR</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <% @caballos_array.each do |caba| %>
            <tr>
              <td class="col-sm-1 text-right"> <%= caba['numero_puesto'] %> </td>
              <td class="col-sm-2 text-left"><%= caba['nombre'] %> </td>
              <td class="col-sm-3 text-right"> <input type="checkbox" title="Esta opcion es delicada, usela con cuidado." data-group-cls="btn-group-sm" id="checab<%= caba['numero_puesto'] %>" <%= caba['retirado'] ? "" : "checked" %> onChange="retirar_cab(<%= caba['numero_puesto']%>,this.checked);" /> </td>
              <td class="col-sm-1 text-left" > <input 
                                                      type="number" 
                                                      class="form-control premiados input-verificar"
                                                      onchange="validar_cantidad(); verificarColor(this);" 
                                                      value="<%= caba['llegada']%>" 
                                                      onkeyup="verificar(this.value,this.id); verificarColor(this);" 
                                                      id="posici<%= caba['numero_puesto'] %>" 
                                                      data-id="<%= caba['id'] %>" 
                                                      name="posicion" 
                                                      maxlength="2" 
                                                      min="0" 
                                                      max="<%= @canti_p %>" 
                                                      style="width: 100%; max-width: 80px;" 
                                                      oninput="validity.valid||(value='');" 
                                                      <%= caba['retirado'] ? 'disabled' : '' %> 
                                                      > 
              </td>
              <td class="col-sm-1 text-left"> <input 
                                                      type="number" 
                                                      class="form-control sugeridos input-verificar sin-spinner" 
                                                      onchange="validar_cantidad(); verificarColor(this);" 
                                                      value="<%= caba['sugerido']%>" 
                                                      id="sugerido<%= caba['numero_puesto'] %>" 
                                                      data-id2="<%= caba['id'] %>" 
                                                      data-puesto="<%= caba['numero_puesto'] %>" 
                                                      name="sugerido" 
                                                      maxlength="2" 
                                                      style="width: 80%; max-width: 80px;" 
                                                      readonly> 
              </td>
              <td class="col-sm-1 text-left"> <input 
                                                      type="number" 
                                                      class="form-control sugeridos_nyra input-verificar sin-spinner" 
                                                      value="<%= caba['sugerido_nyra']%>" 
                                                      id="sugerido_nyra<%= caba['numero_puesto'] %>" 
                                                      data-id2="<%= caba['id'] %>" 
                                                      data-puesto="<%= caba['numero_puesto'] %>" 
                                                      name="sugerido_nyra" 
                                                      maxlength="2" 
                                                      style="width: 80%; max-width: 80px;" 
                                                      readonly> 
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="col-12 col-sm-2">
      <div class="panel panel-default" style="margin-top: 20px;">
        <div class="panel-heading">
          <h3 class="panel-title"><b>Retirados Nyra</b></h3>
        </div>
        <div class="panel-body">
          <% if @retirados_nyra.present? %>
            <% @retirados_nyra_complet.each do |ret| %>
              <p><b><%= ret %></b></p>
            <% end %>
          <% else %>
            <p>No hay retirados Nyra</p>
          <% end %>
        </div>
      </div>
      <% if @retirados_nyra.present? %>
        <input type="button" value="Aplicar Retirados Nyra" class="btn btn-danger" onclick="aplicar_retiro()"/>
      <% end %>
    </div>

  </div>
  <div class="box-footer">
    <input style="margin-bottom: 0.5rem;" type="button" value="Aplicar Resultados Api" class="btn btn-danger" onclick="aplicar_api2()"/>
    <br/>
    <input type="button" value="Aplicar Resultados Nyra" class="btn btn-warning" onclick="aplicar_api()"/>
  </div>

  <%= @premiados%>

<script>
// $(':checkbox').checkboxpicker();
$(':checkbox').checkboxpicker({
  html: true,
  offLabel: "SI",
  onLabel: "NO"
});

function aplicar_api(){
  $('.sugeridos_nyra').each(function( index ) {
    id_bus = $( this ).data("id2") ;
    id_puesto = $( this ).data("puesto") ;
    valor_bus = $( this ).val() ;
    $("#posici"+id_puesto).val(valor_bus);
  });
  document.querySelectorAll('.input-verificar').forEach(input => {
    verificarColor(input);
  })
}

function aplicar_api2(){
  $('.sugeridos').each(function( index ) {
    id_bus = $( this ).data("id2") ;
    id_puesto = $( this ).data("puesto") ;
    valor_bus = $( this ).val() ;
    $("#posici"+id_puesto).val(valor_bus);
  });
  document.querySelectorAll('.input-verificar').forEach(input => {
    verificarColor(input);
  })
}

function aplicar_retiro(){
  retirados = "<%= @retirados_nyra%>".split('-') ;
  retirados.forEach(function (element ){
  $('#checab' + element).prop('checked', false);
  });

}
</script>

<style>
  .input-primero {
    background-color: rgb(103, 255, 113) !important;
  }
  .input-segundo {
    background-color:rgb(165, 235, 203) !important;
  }
  .input-tercero {
    background-color:rgb(255, 253, 121) !important;
  }
  .input-cuarto {
    background-color:rgb(246, 214, 88) !important;
  }
  .input-quinto {
    background-color:  #ffb9b9ff !important;
  }

  .th-responsive {
    display: inline;
  }

  .th-full-text {
    display: inline;
  }

  .th-short-text {
    display: none;
  }

  @media (max-width: 767px) {
    .th-full-text {
      display: none;
    }
    .th-short-text {
      display: inline;
    }
  }

.sin-spinner::-webkit-inner-spin-button,
.sin-spinner::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.sin-spinner {
  -moz-appearance: textfield;
}

</style>

<script>
  function verificarColor(input) {
    const valor = parseInt(input.value);

    input.classList.remove('input-primero', 'input-segundo', 'input-tercero', 'input-cuarto', 'input-quinto');

    if (valor === 1) {
      input.classList.add('input-primero');
    } else if (valor === 2) {
      input.classList.add('input-segundo');
    } else if (valor === 3) {
      input.classList.add('input-tercero');
    } else if (valor === 4) {
      input.classList.add('input-cuarto');
    }else if (valor === 5) {
      input.classList.add('input-quinto');
    } 
  }
</script>
