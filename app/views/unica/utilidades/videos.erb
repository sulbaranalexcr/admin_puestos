<%= javascript_include_tag "axios.js" %>
<%= javascript_include_tag "swalert.js" %>
<script>


function ruta_invalida(){
  if ($('#ruta_input').val()){
    return false ;
  }else{
    return true ;
  }
}

function visualizar(){
  if (ruta_invalida()){
    swal("Error", "Debe ingresar ruta.", "error") ;
    return ;
  }
  axios({
      method: 'POST',
        url: '/unica/utilidades/preview_video',
      data: {
        "id": $('#video option:selected').val()
      },
    })
    .then(function(response) {
        $('#div_preview').html(response.data);
    }
  )
  .catch(function (error) {
    swal("Lo siento", "No hay ruta valida", "error");
  });

}

function verificar_ruta(){
  $('#ruta_input').val('');
  $('#ruta_input').val($('#video option:selected').data('ruta') );
  $('#nombre').val($('#video option:selected').data('nombre') );
}


function cambiar_ruta_func(tipo){
  // if (ruta_invalida()){
  //   swal("Error", "Debe ingresar ruta.", "error") ;
  //   return ;
  // }
  //  id = $('#video option:selected').val() ;
   ruta = $('#ruta_input').val() ;
   nombre = $('#nombre').val() ;
   swal({
    title: 'Advertencia' ,
    text: "Esta seguro de asignar esta ruta?",
    icon: "warning",
    allowOutsideClick: false,
    allowEscapeKey: false,
    closeOnClickOutside: false,
     dangerMode: true,
    buttons: {
    confirm: "Aceptar",
     cancel: "Cancelar",
     },
  })
  .then((willConfirm) => {
    if (willConfirm) {
        swalert_espera("Espere, realizando cambios...")
        axios({
            method: 'POST',
              url: '/unica/utilidades/cambiar_ruta_video',
            data: {
              // "id": id,
              "ruta": ruta,
              "nombre": nombre,
              "tipo": tipo
            },
          })
          .then(function(response) {
            Swal.close();
            swal("Completo", "Datos almacenados.", "success").then((aceptar) => {
              location.reload(true);
            });
          }

        )
        .catch(function (error) {
            Swal.close();
            swal("Lo siento", "Ocurrio un error. Verifique todos los datos", "error");
        });
    }
  });


  }

</script>
<form>
  <div class="row">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Asignar Ruta de Videos Nacionales</h3>
        </div>
        <div class="form-group">
          <div class="box-body">
            <!--label style="margin-left: 10px">Deporte</label>
            <div class="form-group" style="margin-left: 10px;" id="div_deportes">
                <select size=1 class="form-control" name="video" id="video"  style= '' onchange="verificar_ruta();">
                  <option value="0" >Seleccione Video</option>
                  <% for video in RutaVideo.all.order(:nombre) %>
                    <option value="<%= video.id%>" data-ruta="<%= video.url%>" data-nombre="<%= video.nombre%>"><%= video.nombre%></option>
                  <%end%>
                </select>
            </div-->

            <div class="form-group" style="margin-left: 10px;" id="div_deportes">
              <label style="margin-left: 10px">Nombre</label><br>
              <input type="text" value="<%= RutaVideo.last.present? ? RutaVideo.last.nombre : ''%>" name="nombre" id="nombre" class="form-control">
            </div>

            <div class="form-group" style="margin-left: 10px;" id="div_deportes">
              <label style="margin-left: 10px">Ruta</label><br>
              <input type="url" value="<%= RutaVideo.last.present? ? RutaVideo.last.url : '' %>" name="ruta_input" id="ruta_input" class="form-control">
            </div>

            <div class="form-group" style="margin-left: 10px;" >
              <!--a id="boton_procesar" class='btn btn-sm btn-success' onclick="visualizar();">Visualizar <i class="fa fa-refresh"></i></a-->
              <a id="boton_procesar" class='btn btn-sm btn-success' onclick="cambiar_ruta_func('update');">Procesar <i class="fa fa-refresh"></i></a>
              <a id="boton_eliminar" class='btn btn-sm btn-danger' onclick="cambiar_ruta_func('delete');">Eliminar <i class="fa fa-refresh"></i></a>
            </div>

            <div id="div_preview" class="form-group">
           </div>


          </div>
        </div>
      </div>
    </div>
  </form>


