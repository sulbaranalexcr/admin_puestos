<%= javascript_include_tag "axios.js" %>
<%= javascript_include_tag "swalert.js" %>
<script>

  function refrescar_ligas(){
    deporte_id = $("#deportes").val() ;
    if (deporte_id != "0") {
      $("#div_equipos").html("") ;
      verificar_deporte(deporte_id) ;
    }
  }

  function verificar_deporte(id){
    $('#ligas').find('option:not(:first)').remove();
    $('#matchs').find('option:not(:first)').remove();
    $('#finalizado').find('option').remove();
    $('#div_juego').html('') ;
    swalert_espera("Espere, Buscando datos...") ;

      axios({
          method: 'POST',
            url: '/unica/utilidades/buscar_ligas',
          data: {
            "id": id
          },
        })
        .then(function(response) {
          $('#div_ligas').html(response.data) ;
          $("#ligas").select2({
              matcher: select_con_busqueda
          });
          Swal.close();
        }

      )
      .catch(function (error) {
          swal("Lo siento", "Ocurrio un error. Verifique todos los datos", "error");
      });
  }

function verificar_liga(id){
    axios({
      method: 'POST',
        url: '/unica/utilidades/buscar_equipos',
      data: {
        "id": id
      },
    })
    .then(function(response) {
      $('#div_equipos').html(response.data) ;
      $('#div_ligas_sin').remove() ;
    }

  )
  .catch(function (error) {
      swal("Lo siento", "Ocurrio un error. Verifique todos los datos", "error");
  });

}


function cambiar_nombre_func(id){
  nom_lar = $('#equipos_ant_'+ id).val();
  nom_cor = $('#equipos_'+ id).val();
  if (nom_lar === nom_cor){
    swal("Error", "Nombre no fue cambiado.", "error"); 
    return ;
  }

   swal({
    title: 'Advertencia' ,
    text: "Esta seguro que todos los datos son correctos?",
    icon: "warning",
    allowOutsideClick: false,
    allowEscapeKey: false,
    closeOnClickOutside: false,
     dangerMode: true,
    buttons: {
    confirm: "Aceptar",
     cancel: "Cancelar",
     },
  })
  .then((willConfirm) => {
    if (willConfirm) {
        swalert_espera("Espere, realizando cambios...")
        axios({
            method: 'POST',
              url: '/unica/utilidades/cambiar_nombre_ind',
            data: {
              "liga_id": $('#ligas').val(),
              "id": id,
              "nom_lar": nom_lar,
              "nom_cor": nom_cor
            },
          })
          .then(function(response) {
            $('#equipos_ant_'+ id).val(nom_cor);
            $('#td_bg_color_' + id).css('background-color', '') ;
            Swal.close();
            swal("Completo", "Datos almacenados.", "success").then((aceptar) => {

            });
          }

        )
        .catch(function (error) {
            Swal.close();
            swal("Lo siento", "Ocurrio un error. Verifique todos los datos", "error");
        });
    }
  });


  }

</script>
<form>
  <div class="row">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Cambio de nombres Equipos (Unica)</h3>
        </div>
        <div class="form-group">
          <div class="box-body">
            <table boder=0>
              <tr>
                <td valign="top">
                <label for="deporte_label" style="margin-left: 10px">Deporte</label>
                <div class="form-group" style="margin-left: 10px;" id="div_deportes">
                    <select size=1 class="form-control" name="deportes" id="deportes"  style= '' onchange="verificar_deporte(this.value);">
                      <option value="0" >Seleccione deporte</option>
                      <% for deporte in Juego.where.not(juego_id: 4).order(:nombre) %>
                        <option value="<%= deporte.juego_id%>" ><%= deporte.nombre%></option>
                      <%end%>
                    </select>
                  </div>
                </td>
                <td valign="top">
                  <label for="deporte_label" style="margin-left: 10px">Liga</label><br>
                  <div class="form-group" style="margin-left: 10px;" id="div_ligas">
                    <select size=1 class="form-control" name="ligas" id="ligas"  onchange="verificar_liga(this.value);">
                      <option value="0" >Seleccione Liga </option>
                    </select>
                  </div>
                </td>
                <td style="padding-top: 25px;padding-left: 5px" valign="top">
                  <a class='btn btn-sm btn-success' onclick="refrescar_ligas();"><i class="fa fa-refresh"></i></a>
                </td>
              </tr>
            </table>
            <div class="form-group">
              <div id='div_equipos'>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  <script>
    $( document ).ready(function() {
    
    $("#fecha").change();
    });
  </script>
