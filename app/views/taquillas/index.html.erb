<script>



   function crear_nuevo(){
     window.location.href = "/taquillas/new?grupo="+$('#grupo_enviar').val();
   }


  function buscar_por_grupo(id){
      $.ajax({
        type : "POST",
        url : '/taquillas/buscar_por_grupo',
        data : {
          id: id
        },
        success : function(request) {
          $('#cuerpo_usuarios').html(request);
          $('#div_nuevo').show();
          $('#grupo_enviar').val(id);
        }
      });
  }

  function recargar(id){
      $.ajax({
        type : "POST",
        url : '/solicitudes/verificar_recarga',
        data : {
          id: id
        },
        success : function(request) {
          // window.location.href ="/solicitudes/recargas/?id="+id ;

        //   $.redirect('/solicitudes/recargas',
        // {
        //     id : id
        //   });
        },
        error : function(request) {
        swal("Lo siento", "Cliente no posee solicitudes pendientes.", "error");
        }
      });
  }



  function retirar(id){
      $.ajax({
        type : "POST",
        url : '/solicitudes/verificar_retiro',
        data : {
          id: id
        },
        success : function(request) {
          // window.location.href ="/solicitudes/recargas/?id="+id ;

        //   $.redirect('/solicitudes/recargas',
        // {
        //     id : id
        //   });
        },
        error : function(request) {
        swal("Lo siento", "Cliente no posee solicitudes pendientes.", "error");
        }
      });
  }


  function ajustar(id){
      $.ajax({
        type : "POST",
        url : '/solicitudes/ajustar_saldos',
        data : {
          id: id
        },
        success : function(request) {

        },
        error : function(request) {
        swal("Lo siento", "Ocurrio un error.", "error") ;
        }
      });
  }



</script>
<input type="hidden" id="grupo_enviar">

<div class="row">
  <div class="col-xs-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Clientes</h3>
        </div>
        <div class="box-body">
          <div id="user_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
            <div class="row">
              <div class="col-sm-12">
                <%if session[:usuario_actual]['tipo'] == "ADM"%>
                  <div class="col" style="display: none;" id="div_nuevo">
                    <div class="col-md-2 col-md-offset-10">
                      <%= link_to 'Ver Todas', '/taquillas?all=true', class: 'btn btn-success mr-2' %>
                      <a class="btn btn-success" onclick="crear_nuevo();">Nuevo Cliente</a>
                    </div>
                  </div>
                <%else %>
                  <div class="row" id="div_nuevo2">
                    <div class="col-md-2 col-md-offset-10">
                      <%= link_to 'Nuevo Cliente', new_taquilla_path, class:'btn btn-success pull-right', style: 'margin-bottom: 1.5rem;'%>
                    </div>
                  </div>
                <%end%>

                <%if session[:usuario_actual]['tipo'] == "ADM"%>
                <div class="form-group">
                  <label for="grupo_id">Grupos</label>
                  <select size=1 class="form-control" placeholder="Grupo"  style="width: 100%;" onchange="buscar_por_grupo(this.value);" class="form-control" id="grupo_select">
                    <option value="0" >Seleccione Grupo</option>
                    <%for grupo in Grupo.all.order(:nombre)%>
                      <option value="<%= grupo.id %>"><%= grupo.nombre %></option>
                    <%end%>
                  </select>
                </div>

                <div id="cuerpo_usuarios">
                </div>
                <%else%>
                  <div id="cuerpo_usuarios">
                    <% if request.user_agent =~ /Mobile/ %>
                      <%= render partial: 'cuerpo_cel' %>
                    <% else %>
                      <%= render partial: 'cuerpo' %>
                    <% end %>
                  </div>
                <%end%>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
